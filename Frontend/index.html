<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .container { display: flex; min-height: 100vh; }
        .sidebar {
            width: 260px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            padding: 30px 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            position: fixed;
            height: 100vh;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
        }
        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #10B981, #059669);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .logo-text { font-size: 20px; font-weight: 700; }
        .profile-info {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 30px;
            font-size: 12px;
            color: #10B981;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            margin-bottom: 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: #94a3b8;
            font-weight: 500;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        .nav-item.active {
            background: linear-gradient(135deg, #10B981, #059669);
            color: #fff;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 40px;
        }
        .page-title { font-size: 36px; font-weight: 700; margin-bottom: 8px; }
        .page-subtitle { color: #94a3b8; font-size: 16px; margin-bottom: 30px; }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 24px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon { font-size: 32px; margin-bottom: 12px; }
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 12px 0 8px 0;
        }
        .stat-label { color: #94a3b8; font-size: 14px; }
        .form-group { margin-bottom: 24px; }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: #cbd5e1;
        }
        input, select {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #10B981;
            background: rgba(255, 255, 255, 0.08);
        }
        select { cursor: pointer; }
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #10B981, #059669);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        .btn-full { width: 100%; }
        .btn-secondary {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
        }
        .message {
            padding: 14px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10B981;
        }
        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #EF4444;
        }
        .expense-list { max-height: 600px; overflow-y: auto; }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        .expense-item:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateX(4px);
        }
        .expense-category {
            font-weight: 600;
            color: #10B981;
            margin-bottom: 4px;
        }
        .expense-date { font-size: 13px; color: #94a3b8; }
        .expense-amount {
            font-size: 20px;
            font-weight: 700;
            margin-right: 12px;
        }
        .btn-delete {
            padding: 8px 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #EF4444;
            cursor: pointer;
            font-size: 13px;
        }
        .chart-container { margin-top: 30px; text-align: center; }
        .chart-container img {
            max-width: 100%;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        .setup-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 40px;
        }
        .setup-header { text-align: center; margin-bottom: 40px; }
        .setup-icon { font-size: 64px; margin-bottom: 20px; }
        .section { display: none; }
        .section.active { display: block; }
    </style>
</head>
<body>
    <div id="setup-screen" class="setup-container card">
        <div class="setup-header">
            <div class="setup-icon">üí∞</div>
            <h1>Expense Tracker</h1>
            <p class="page-subtitle">Smart budgeting with real financial data</p>
        </div>
        <div id="setup-message"></div>
        <div class="form-group">
            <label class="form-label">Annual Salary ($)</label>
            <input type="number" id="salary-input" placeholder="60000" min="0">
        </div>
        <button class="btn btn-full" onclick="setupProfile()">Get Started ‚Üí</button>
    </div>

    <div id="main-app" class="container" style="display: none;">
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">üí∞</div>
                <div class="logo-text">Expense Tracker</div>
            </div>
            <div class="profile-info" id="profile-display">
                Annual: $0<br>Monthly: $0
            </div>
            <nav>
                <div class="nav-item active" onclick="showSection('add')">
                    ‚ûï Add Expense
                </div>
                <div class="nav-item" onclick="showSection('view')">
                    üìã View Expenses
                </div>
                <div class="nav-item" onclick="showSection('analyze')">
                    üìä Analysis
                </div>
            </nav>
        </div>

        <div class="main-content">
            <div id="add-section" class="section active">
                <h1 class="page-title">Add Expense</h1>
                <p class="page-subtitle">Track your spending</p>
                <div class="card" style="max-width: 600px;">
                    <div id="add-message"></div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="expense-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select id="expense-category">
                            <option value="Housing">üè† Housing</option>
                            <option value="Food" selected>üçΩÔ∏è Food</option>
                            <option value="Transportation">üöó Transportation</option>
                            <option value="Utilities">‚ö° Utilities</option>
                            <option value="Entertainment">üé¨ Entertainment</option>
                            <option value="Healthcare">‚ù§Ô∏è Healthcare</option>
                            <option value="Education">üéì Education</option>
                            <option value="Shopping">üõçÔ∏è Shopping</option>
                            <option value="Phone">üì± Phone</option>
                            <option value="Dining Out">‚òï Dining Out</option>
                            <option value="Other">‚ûï Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount ($)</label>
                        <input type="number" id="expense-amount" placeholder="0.00" step="0.01" min="0">
                    </div>
                    <button class="btn btn-full" onclick="addExpense()">Add Expense</button>
                </div>
            </div>

            <div id="view-section" class="section">
                <h1 class="page-title">Your Expenses</h1>
                <p class="page-subtitle">Track and manage transactions</p>
                <div class="stats-grid" id="stats-container"></div>
                <div class="card">
                    <h3 style="margin-bottom: 20px;">Transaction History</h3>
                    <div id="expenses-list" class="expense-list"></div>
                </div>
            </div>

            <div id="analyze-section" class="section">
                <h1 class="page-title">Analysis & Charts</h1>
                <p class="page-subtitle">Visualize your spending patterns</p>
                <div class="card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <h3>Generated Charts</h3>
                        <button class="btn btn-secondary" onclick="refreshCharts()">üîÑ Refresh</button>
                    </div>
                    <p class="page-subtitle">Run: <code>cd backend-python && python analyze.py</code></p>
                    <div id="charts-message"></div>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <h4 style="margin-bottom: 15px;">Category Breakdown</h4>
                            <img id="category-chart" src="../backend-python/static/category_chart.png" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="empty-state" style="display: none;">
                                <div class="empty-state-icon">üìä</div>
                                <p>Run Python analysis first</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 style="margin-bottom: 15px;">Timeline</h4>
                            <img id="timeline-chart" src="../backend-python/static/timeline_chart.png" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="empty-state" style="display: none;">
                                <div class="empty-state-icon">üìà</div>
                                <p>Run Python analysis first</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 style="margin-bottom: 15px;">Comparison</h4>
                            <img id="comparison-chart" src="../backend-python/static/comparison_chart.png" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="empty-state" style="display: none;">
                                <div class="empty-state-icon">üìâ</div>
                                <p>Run Python analysis first</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API = 'http://localhost:4567';
        let profile = null;

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('expense-date').valueAsDate = new Date();
            checkProfile();
        });

        async function checkProfile() {
            try {
                const res = await fetch(`${API}/profile`);
                const p = await res.json();
                if (p.setup && p.salary > 0) {
                    profile = p;
                    showMainApp();
                }
            } catch (e) {}
        }

        async function setupProfile() {
            const salary = parseFloat(document.getElementById('salary-input').value);
            if (!salary || salary <= 0) {
                showMsg('setup-message', 'Enter valid salary', 'error');
                return;
            }
            try {
                const res = await fetch(`${API}/profile`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ salary, setup: true })
                });
                const result = await res.json();
                if (result.success) {
                    profile = { salary, setup: true };
                    showMainApp();
                }
            } catch (e) {
                showMsg('setup-message', 'Server error!', 'error');
            }
        }

        function showMainApp() {
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            document.getElementById('profile-display').innerHTML = `
                Annual: $${profile.salary.toLocaleString()}<br>
                Monthly: $${(profile.salary/12).toLocaleString(undefined, {maximumFractionDigits: 0})}
            `;
            loadExpenses();
        }

        function showSection(name) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`${name}-section`).classList.add('active');
            if (name === 'view') loadExpenses();
            if (name === 'analyze') refreshCharts();
        }

        async function addExpense() {
            const date = document.getElementById('expense-date').value;
            const category = document.getElementById('expense-category').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            if (!date || !category || !amount || amount <= 0) {
                showMsg('add-message', 'Fill all fields!', 'error');
                return;
            }
            try {
                const res = await fetch(`${API}/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date, category, amount })
                });
                const result = await res.json();
                if (result.success) {
                    showMsg('add-message', `Added $${amount.toFixed(2)}`, 'success');
                    document.getElementById('expense-amount').value = '';
                }
            } catch (e) {
                showMsg('add-message', 'Server error!', 'error');
            }
        }

        async function loadExpenses() {
            try {
                const res = await fetch(`${API}/expenses`);
                const expenses = await res.json();
                updateStats(expenses);
                const list = document.getElementById('expenses-list');
                if (expenses.length === 0) {
                    list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>No expenses yet</p></div>';
                    return;
                }
                list.innerHTML = expenses.reverse().map(e => `
                    <div class="expense-item">
                        <div>
                            <div class="expense-category">${e.category}</div>
                            <div class="expense-date">${new Date(e.date).toLocaleDateString()}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="expense-amount">$${e.amount.toFixed(2)}</div>
                            <button class="btn-delete" onclick="deleteExpense(${e.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {}
        }

        function updateStats(expenses) {
            const total = expenses.reduce((s, e) => s + e.amount, 0);
            const count = expenses.length;
            const avg = count > 0 ? total / count : 0;
            const cats = new Set(expenses.map(e => e.category)).size;
            document.getElementById('stats-container').innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value" style="color: #10B981;">$${total.toFixed(2)}</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-value" style="color: #3B82F6;">${count}</div>
                    <div class="stat-label">Transactions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" style="color: #8B5CF6;">$${avg.toFixed(2)}</div>
                    <div class="stat-label">Average</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üè∑Ô∏è</div>
                    <div class="stat-value" style="color: #F59E0B;">${cats}</div>
                    <div class="stat-label">Categories</div>
                </div>
            `;
        }

        async function deleteExpense(id) {
            if (!confirm('Delete this expense?')) return;
            try {
                await fetch(`${API}/expense/${id}`, { method: 'DELETE' });
                loadExpenses();
            } catch (e) {}
        }

        function refreshCharts() {
            const t = new Date().getTime();
            document.getElementById('category-chart').src = `../backend-python/static/category_chart.png?t=${t}`;
            document.getElementById('timeline-chart').src = `../backend-python/static/timeline_chart.png?t=${t}`;
            document.getElementById('comparison-chart').src = `../backend-python/static/comparison_chart.png?t=${t}`;
        }

        function showMsg(id, text, type) {
            const el = document.getElementById(id);
            el.innerHTML = `<div class="message ${type}">${type === 'success' ? '‚úÖ' : '‚ùå'} ${text}</div>`;
            setTimeout(() => el.innerHTML = '', 5000);
        }
    </script>
</body>
</html>